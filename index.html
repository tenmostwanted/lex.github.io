<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-记录一次事故" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/09/10/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1%E4%BA%8B%E6%95%85/" class="article-date">
  <time class="dt-published" datetime="2024-09-10T15:08:57.000Z" itemprop="datePublished">2024-09-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/09/10/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1%E4%BA%8B%E6%95%85/">记录项目中一个令人汗流浃背的小插曲之改库跑路？？？？</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="事情背景"><a href="#事情背景" class="headerlink" title="事情背景"></a>事情背景</h2><p>有一天1组的同学发现，他们进行从日期截止至x月x日之前创建的所有工作流，绑定的技能id全被改了。</p>
<p>四周一问，谁也都说，不知道发生了什么。</p>
<p>最后导师归因的时候说是有人update了没有where，导致全表扫描了。<br>而恰好，我组的同学正好是唯一有权限接触到数据库的几位……<br>这顶小黑锅肯定就是由我们漂漂亮亮地背上了。</p>
<p>当然，权限出在我们几位身上，工作流的技能之外部知识库id也是跟我们有关的一环，我觉得这个定位很合理，是唯一的可能。</p>
<p>但是真的不甘心，哈哈。<br>于是想到了，mysql有binlog，应该可以查到数据库的删改记录呀。</p>
<p>一番操作：</p>
<p>（我们使用docker compose直接部署的项目，所以进入到docker mysql里面看吧）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker ps</span><br><span class="line">docker  exec -it mysql </span><br><span class="line">mysql -uuser -ppwd</span><br><span class="line">show variables like ‘bin_log’; </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>结果，华丽丽地是off。。。。<br>根本没开binlog啊。。。。。可能前辈们是处于一些性能开销的考虑吧。</p>
<p>ps. 本文涉及到一些数据隐私的问题，都没有截图，凭记忆写了</p>
<p>如果是小项目的话，设置一下清理时间比如在my.cnf里面开启.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">expire_logs_days=7   # 只保留最近7天的二进制日志</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>然后减少内存上的占用，至于性能开销这部分，还是只能如此吧&gt;&lt;</p>
<p>不过，虽然，这次没有用到。<br>还是学习了一下如何恢复mysql数据库到某版本。</p>
<h2 id="如何从BINLOG中恢复数据库"><a href="#如何从BINLOG中恢复数据库" class="headerlink" title="如何从BINLOG中恢复数据库"></a>如何从BINLOG中恢复数据库</h2><h4 id="前提条件："><a href="#前提条件：" class="headerlink" title="前提条件："></a>前提条件：</h4><ol>
<li><strong>启用了二进制日志</strong>：确保在执行数据变更前，已经启用了 MySQL 的二进制日志（<code>log-bin</code>）。</li>
<li><strong>有全备份</strong>：通常情况下，恢复流程分为两步：先恢复最近的全备份，然后应用二进制日志来恢复到指定的时间点。</li>
</ol>
<h4 id="恢复步骤："><a href="#恢复步骤：" class="headerlink" title="恢复步骤："></a>恢复步骤：</h4><h5 id="1-准备全备份"><a href="#1-准备全备份" class="headerlink" title="1. 准备全备份"></a>1. <strong>准备全备份</strong></h5><p>首先，找到最近的数据库全备份（通常是通过 <code>mysqldump</code> 或物理备份工具如 <code>Percona XtraBackup</code> 制作的备份）。</p>
<p>恢复全备份的命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p &lt; full_backup.sql</span><br></pre></td></tr></table></figure>

<h5 id="2-找出需要的二进制日志文件"><a href="#2-找出需要的二进制日志文件" class="headerlink" title="2. 找出需要的二进制日志文件"></a>2. <strong>找出需要的二进制日志文件</strong></h5><p>使用以下命令查看当前的二进制日志文件列表：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="type">BINARY</span> LOGS;</span><br></pre></td></tr></table></figure>

<p>输出的结果将列出所有的二进制日志文件，如 <code>mysql-bin.000001</code>，<code>mysql-bin.000002</code> 等。</p>
<h5 id="3-确定恢复点"><a href="#3-确定恢复点" class="headerlink" title="3. 确定恢复点"></a>3. <strong>确定恢复点</strong></h5><p>有两种恢复方式：</p>
<ul>
<li><strong>基于时间点</strong>（Point in Time）：恢复到特定的时间。</li>
<li><strong>基于事务ID</strong>（Transaction ID）：恢复到特定的事务。</li>
</ul>
<h5 id="4-使用-mysqlbinlog-分析二进制日志"><a href="#4-使用-mysqlbinlog-分析二进制日志" class="headerlink" title="4. 使用 mysqlbinlog 分析二进制日志"></a>4. <strong>使用 mysqlbinlog 分析二进制日志</strong></h5><ul>
<li>基于时间点恢复：<br>查看二进制日志中的时间信息，确定在哪个时间点停止：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqlbinlog --start-datetime=<span class="string">&quot;2024-09-10 10:00:00&quot;</span> --stop-datetime=<span class="string">&quot;2024-09-10 12:00:00&quot;</span> /path/to/mysql-bin.000002 &gt; restore.sql</span><br></pre></td></tr></table></figure>

<ul>
<li><code>--start-datetime</code>：开始恢复的时间点。</li>
<li><code>--stop-datetime</code>：停止恢复的时间点。</li>
</ul>
<h5 id="5-应用二进制日志"><a href="#5-应用二进制日志" class="headerlink" title="5. 应用二进制日志"></a>5. <strong>应用二进制日志</strong></h5><p>将导出的 SQL 语句重新应用到数据库，恢复到指定时间点或版本。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p &lt; restore.sql</span><br></pre></td></tr></table></figure>

<p>如果你想让日志从特定的起点到当前时刻都应用，也可以直接使用 <code>mysqlbinlog</code> 命令将二进制日志应用到数据库：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqlbinlog /var/lib/mysql/mysql-bin.000002 | mysql -u root -p</span><br></pre></td></tr></table></figure>

<h5 id="6-基于事务ID恢复（可选）"><a href="#6-基于事务ID恢复（可选）" class="headerlink" title="6. 基于事务ID恢复（可选）"></a>6. <strong>基于事务ID恢复（可选）</strong></h5><p>如果你知道具体的事务ID（如某个错误操作），可以基于事务ID进行恢复。首先用 <code>mysqlbinlog</code> 查看事务信息：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqlbinlog --start-position=12345 --stop-position=23456 /path/to/mysql-bin.000002 &gt; restore.sql</span><br></pre></td></tr></table></figure>

<p>然后应用生成的SQL文件来恢复：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p &lt; restore.sql</span><br></pre></td></tr></table></figure>

<h5 id="7-验证恢复"><a href="#7-验证恢复" class="headerlink" title="7. 验证恢复"></a>7. <strong>验证恢复</strong></h5><p>恢复完毕后，检查数据库中的数据是否恢复到了所需的时间点或版本。可以通过查询关键表中的数据或检查系统状态来确认。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>下次，动数据库前，如果没有开启binlog，一定先备份+找人CR。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/09/10/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1%E4%BA%8B%E6%95%85/" data-id="cm0xgtuv8000205nmfojs1a04" data-title="记录项目中一个令人汗流浃背的小插曲之改库跑路？？？？" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-mysql是怎样存储的-md" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/09/03/mysql%E6%98%AF%E6%80%8E%E6%A0%B7%E5%AD%98%E5%82%A8%E7%9A%84-md/" class="article-date">
  <time class="dt-published" datetime="2024-09-03T00:56:40.000Z" itemprop="datePublished">2024-09-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/09/03/mysql%E6%98%AF%E6%80%8E%E6%A0%B7%E5%AD%98%E5%82%A8%E7%9A%84-md/">Mysql是怎样存储的</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="进入Docker-Mysql，用命令行查看Mysql的存储目录"><a href="#进入Docker-Mysql，用命令行查看Mysql的存储目录" class="headerlink" title="进入Docker Mysql，用命令行查看Mysql的存储目录"></a>进入Docker Mysql，用命令行查看Mysql的存储目录</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">docker ps;</span><br><span class="line"></span><br><span class="line">docker exec -it mysql bash;  # enter to docker mysql</span><br><span class="line"></span><br><span class="line">mysql -uuser -ppwd;</span><br><span class="line"></span><br><span class="line">show variables like &#x27; datadir&#x27;; #查看Mysql存储在哪个目录</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>发现都是存储在var&#x2F;lib&#x2F;mysql这个地方</p>
<p><img src="/images/mysql%E6%98%AF%E6%80%8E%E6%A0%B7%E5%AD%98%E5%82%A8%E7%9A%84-md/image.png" alt="alt text"></p>
<h3 id="MySQL-的-NULL-值是怎么存放的？"><a href="#MySQL-的-NULL-值是怎么存放的？" class="headerlink" title="MySQL 的 NULL 值是怎么存放的？"></a>MySQL 的 NULL 值是怎么存放的？</h3><p>row的左边（变长字端长度+Null列表）｜ 真实数据</p>
<p>在MySQL表中，NULL 并不占用实际的空间来存放具体的数值，而是通过一个“NULL标志位”来标识字段的值是否为 NULL。这些标志位是和数据一起存储的。</p>
<p>在比较操作中，NULL 被视为一个特殊的值，无法与其他数值进行直接比较（包括 NULL 本身）。使用 IS NULL 或 IS NOT NULL 来判断 NULL。</p>
<pre><code>•	在索引中，如果字段允许为 NULL，那么 NULL 也会被视为索引值的一部分。 在B-Tree索引或Hash索引中，NULL 被处理为一个特殊的值。
</code></pre>
<p>![[Pasted image 20240903091756.png]]</p>
<h3 id="varchar（n）中n最大是多少？"><a href="#varchar（n）中n最大是多少？" class="headerlink" title="varchar（n）中n最大是多少？"></a>varchar（n）中n最大是多少？</h3><p>最大长度为 65535 字节，这是由于 MySQL 的行最大长度限制。</p>
<p>需要注意的是，n 是字符个数，不是字节数。实际存储的字节数还取决于所使用的字符集。</p>
<p>当然了，还得考虑，变长字段的额外开销，1字节记录Null值，2字节记录变长字段的数量。</p>
<p>如果是UTF-8的，一个字符占3个字节。就是（65535-2-1）&#x2F;3&#x3D;21844。</p>
<h3 id="行溢出后，Mysql是如何处理的？"><a href="#行溢出后，Mysql是如何处理的？" class="headerlink" title="行溢出后，Mysql是如何处理的？"></a>行溢出后，Mysql是如何处理的？</h3><p>对于InnoDB而言，会放入溢出页。</p>
<p>而不是将其存储在B-Tree叶子节点中。溢出页的结构和B-Tree叶子节点相同，都是由指针数组和溢出数据组成的。</p>
<p>PS. 在真实存放数据的地方会用20个字节的指针指向溢出页，以找到溢出后的数据。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/09/03/mysql%E6%98%AF%E6%80%8E%E6%A0%B7%E5%AD%98%E5%82%A8%E7%9A%84-md/" data-id="cm0xgtuv7000105nmfdnr13mm" data-title="Mysql是怎样存储的" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-20240903-01-15" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/09/03/20240903-01-15/" class="article-date">
  <time class="dt-published" datetime="2024-09-02T17:17:00.000Z" itemprop="datePublished">2024-09-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/09/03/20240903-01-15/">在MAC上用hexo+GithubPage搭建私人博客</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h4 id="踩坑点记录"><a href="#踩坑点记录" class="headerlink" title="踩坑点记录"></a>踩坑点记录</h4><ul>
<li><p>没有权限的问题。<br>sudo -i &#x2F; sudo -s 切换一下。</p>
</li>
<li><p>npm install 下载失败<br>换一下npm config里面的源，换成国内源即可。</p>
</li>
<li><p>Github 权限<br>虽然是，SSH 可以连上，但是hexo d部署的时候，还是显示权限问题；<br>换了另一种，PAT，加个Token，然后还是https的repo，输入密码的时候把密码改为token。</p>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/09/03/20240903-01-15/" data-id="cm0xgtuv5000005nm66xadwr6" data-title="在MAC上用hexo+GithubPage搭建私人博客" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/09/">September 2024</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/09/10/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1%E4%BA%8B%E6%95%85/">记录项目中一个令人汗流浃背的小插曲之改库跑路？？？？</a>
          </li>
        
          <li>
            <a href="/2024/09/03/mysql%E6%98%AF%E6%80%8E%E6%A0%B7%E5%AD%98%E5%82%A8%E7%9A%84-md/">Mysql是怎样存储的</a>
          </li>
        
          <li>
            <a href="/2024/09/03/20240903-01-15/">在MAC上用hexo+GithubPage搭建私人博客</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>